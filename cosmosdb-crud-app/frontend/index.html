<!DOCTYPE html>
<html>
<head>
  <title>Product CRUD</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { margin: 5px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h2>Product Management</h2>

  <input id="id" placeholder="ID">
  <input id="name" placeholder="Name">
  <input id="category" placeholder="Category">
  <input id="price" placeholder="Price">
  <br>
  <button onclick="createProduct()">Create</button>
  <button onclick="updateProduct()">Update</button>
  <button onclick="readProduct()">Read</button>
  <button onclick="deleteProduct()">Delete</button>

  <h3>All Products</h3>
  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Category</th><th>Price</th></tr>
    </thead>
    <tbody id="products-body"></tbody>
  </table>

  <script>
    const API_URL = "/api/ProductFunction";

    async function createProduct() {
      const product = getProductFormData();
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(product)
      });
      alert((await response.json()).message || "Error");
      loadProducts();
    }

    async function updateProduct() {
      const product = getProductFormData();
      const response = await fetch(API_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(product)
      });
      alert((await response.json()).message || "Error");
      loadProducts();
    }

    async function readProduct() {
      const id = document.getElementById("id").value;
      const category = document.getElementById("category").value;
      const response = await fetch(`${API_URL}?id=${id}&Category=${category}`);
      alert(JSON.stringify(await response.json(), null, 2));
    }

    async function deleteProduct() {
      const id = document.getElementById("id").value;
      const category = document.getElementById("category").value;
      const response = await fetch(`${API_URL}?id=${id}&Category=${category}`, { method: "DELETE" });
      alert((await response.json()).message || "Error");
      loadProducts();
    }

    async function loadProducts() {
      const response = await fetch(API_URL);
      const text = await response.text();
      const products = text ? JSON.parse(text) : [];
      const tbody = document.getElementById("products-body");
      tbody.innerHTML = "";
      products.forEach(p => {
        tbody.innerHTML += `<tr>
          <td>${p.id}</td><td>${p.name}</td><td>${p.Category}</td><td>${p.price}</td>
        </tr>`;
      });
    }

    function getProductFormData() {
      return {
        id: document.getElementById("id").value,
        name: document.getElementById("name").value,
        Category: document.getElementById("category").value,
        price: parseFloat(document.getElementById("price").value || 0)
      };
    }

    window.onload = loadProducts;
  </script>
</body>
</html>

